<!doctype html>
<html lang="de">
<html>
	<head>
		<link rel="apple-touch-icon" href="style/images/aster.ico">
		<link rel="icon" href="style/images/aster.ico">
		<meta charset="utf-8">
		<script src="vendor/couchapp/jquery.js"></script>
		<script src="vendor/couchapp/bootstrap.js"></script>
		<script src="vendor/couchapp/jquery.jstree.js"></script>
		<script src="vendor/couchapp/jquery.cookie.js"></script>
		<script src="vendor/couchapp/jquery.hotkeys.js"></script>
		<script src="vendor/couchapp/jquery.couch.js"></script>
		<script src="vendor/couchapp/artendb.js"></script>
		<link rel="stylesheet" href="style/bootstrap.css">
		<link rel="stylesheet" href="style/artendb.css">
		<script src="vendor/couchapp/modernizr.js"></script>
		<title>ArtenDb</title>
	</head>
	<body>
		<fieldset id="menu">
			<div>
				<div id="menu-div">
					<div id="menu_btn" class="btn-group">
						<a class="btn dropdown-toggle btn-inverse" data-toggle="dropdown" href="#">
							Menu
							<span class="caret"></span>
						</a>
						<ul class="dropdown-menu">
							<li class="dropdown-submenu">
								<a tabindex="-1" href="#">Daten importieren / löschen</a>
								<ul class="dropdown-menu">
									<li class="dropdown-submenu">
										<a tabindex="-1" href="#">Taxonomie</a>
										<ul class="dropdown-menu">
											<li class="disabled"><a id="aktuelle_taxonomie_importieren" href="#">aktuelle Taxonomie importieren</a></li>
											<li class="disabled"><a id="aktuelle_taxonomie_loeschen" href="#">aktuelle Taxonomie löschen</a></li>
											<li class="disabled"><a id="alternative_taxonomie_importieren" href="#">alternative Taxonomie importieren</a></li>
											<li class="disabled"><a id="alternative_taxonomie_loeschen" href="#">alternative Taxonomie löschen</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu">
										<a tabindex="-1" href="#">Eigenschaften</a>
										<ul class="dropdown-menu">
											<li><a id="eigenschaften_importieren" href="#">importieren</a></li>
											<li class="disabled"><a id="eigenschaften_loeschen" href="#">löschen</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu">
										<a tabindex="-1" href="#">Beziehungen</a>
										<ul class="dropdown-menu">
											<li class="disabled"><a id="beziehungen_importieren" href="#">importieren</a></li>
											<li class="disabled"><a id="beziehungen_loeschen" href="#">löschen</a></li>
										</ul>
									</li>
								</ul>
							</li>
							<li class="disabled"><a href="#">Daten exportieren</a></li>
							<li class="dropdown-submenu">
								<a tabindex="-1" href="#">über diese Anwendung</a>
								<ul class="dropdown-menu">
									<li><a href="https://github.com/barbalex/artendb/blob/master/README.md" target="_blank">Projektbeschreibung</a></li>
									<li><a href="https://github.com/barbalex/artendb" target="_blank">Code</a></li>
									<li><a href="mailto:alex.barbalex@gmail.com">Kontakt</a></li>
								</ul>
							</li>
							<li id="GoogleBilderLink_li" class="disabled"><a id="GoogleBilderLink" href="" target="_blank">Bilder suchen</a></li>
							<li id="WikipediaLink_li" class="disabled"><a id="WikipediaLink" href="" target="_blank">in Wikipedia suchen</a></li>
						</ul>
					</div>
					<div id="Gruppe_label">Gruppe wählen:</div>
				</div>
				<div id="Gruppe" class="btn-group" data-toggle="buttons-radio">
					<button class="btn btn-inverse" name="Gruppe" id="GruppeFauna" value="Fauna" treeBeschriftung="Tiere">Fauna</button>
					<button class="btn btn-inverse" name="Gruppe" id="GruppeFlora" value="Flora" treeBeschriftung="Pflanzen">Flora</button>
					<button class="btn btn-inverse" name="Gruppe" id="GruppeMoose" value="Moose" treeBeschriftung="Moose">Moose</button>
					<button class="btn btn-inverse" name="Gruppe" id="GruppeMacromycetes" value="Macromycetes" treeBeschriftung="Pilze">Pilze</button>
					<button class="btn btn-inverse" name="Gruppe" id="GruppeLebensräume" value="Lebensräume" treeBeschriftung="Lebensräume">Lebensräume</button>
				</div>
			</div>
			<div id="suchen" class="input-prepend">
				<span class="add-on"><i id="suchfeld_icon" class="icon-search"></i></span><input id="suchfeld" class="span2" type="search" placeholder="filtern">
				<button id="suche_leeren_btn" class="close">&times;</button>
			</div>
			<div id="treeBeschriftung"></div>
			<div id="tree"></div>
		</fieldset>

		<fieldset id="forms">

			<form id="art" class="form form-horizontal" action="#" method="get" autocomplete="off" style="display:none;"></form>
			
			<form id="import" class="form form-horizontal" action="#" method="get" autocomplete="off" style="display:none;">
				<div class="accordion" id="importieren_accordion">
					<div class="accordion-group" id="importieren_anmelden">
						<div class="accordion-heading accordion-group_gradient">
							<a id="importieren_anmelden_titel" class="accordion-toggle" data-toggle="collapse" data-parent="#importieren_accordion" href="#importieren_anmelden_collapse">1. Anmelden</a>
						</div>
						<div class="accordion-body collapse" id="importieren_anmelden_collapse">
							<div class="accordion-inner">
								<div class="control-group">
									<label class="control-label" for="Email">Email</label>
									<div class="controls">
										<input type="email" id="Email" placeholder="Email" required>
										<div id="Emailhinweis" class="hinweis text-error">Bitte Email erfassen</div>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label" for="Passwort">Passwort</label>
									<div class="controls">
										<input type="password" id="Passwort" placeholder="Passwort" required>
										<div id="Passworthinweis" class="hinweis text-error">Bitte Passwort erfassen</div>
										<div class="signup">Vorsicht: Email und Passwort können später nicht mehr geändert werden!</div>
										<div class="signup">Es wird eine verschlüsselte Version des Passworts gespeichert. Das Original kennt ausser Ihnen niemand.</div>
									</div>
								</div>
								<div class="control-group signup">
									<label class="control-label" for="Passwort2">Passwort bestätigen</label>
									<div class="controls">
										<input type="password" id="Passwort2" placeholder="Passwort bestätigen" required>
										<div id="Passwort2hinweis" class="hinweis text-error">Bitte Passwort bestätigen</div>
										<div id="Passwort2hinweisFalsch" class="hinweis text-error">Die Passwörter stimmen nicht überein</div>
									</div>
								</div>
								<div class="control-group">
									<div class="controls">
										<button id="anmelden_btn" class="btn">anmelden</button>
										<button id="konto_erstellen_btn" class="btn">neues Konto erstellen</button>
										<button id="konto_speichern_btn" class="btn" style="display:none;">neues Konto speichern</button>
									</div>
								</div>
								<div id="importieren_anmelden_fehler" class="alert alert-error">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_anmelden_fehler_text"></div>
								</div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_ds_beschreiben">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="#importieren_accordion" href="#importieren_ds_beschreiben_collapse">
								2. Datensammlung beschreiben
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_ds_beschreiben_collapse">
							<div class="accordion-inner">
								
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_daten_uploaden">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="#importieren_accordion" href="#importieren_daten_uploaden_collapse">
								3. Daten uploaden
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_daten_uploaden_collapse">
							<div class="accordion-inner">
								
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_ids_identifizieren">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="#importieren_accordion" href="#importieren_ids_identifizieren_collapse">
								4. ID's identifizieren
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_ids_identifizieren_collapse">
							<div class="accordion-inner">
								
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_import_ausfuehren">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="#importieren_accordion" href="#importieren_import_ausfuehren_collapse">
								5. Import ausführen
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_import_ausfuehren_collapse">
							<div class="accordion-inner">
								
							</div>
						</div>
					</div>

				</div>		
			</form>

		</fieldset>

		<script>
			$(document).ready(function () {
				$("#forms").hide();
				//prüfen, ob media queries unterstützt werden. Wenn nein, melden und Einsteigen verhindern
				if (!Modernizr.mq('(min-width: 10px)')) {
					$('#meldung_kompatibilität').modal();
					return;
				}

				$("#suchen").hide();

				//wenn User noch angemeldet ist, UI anpassen
				if (localStorage.Email) {
					$("#importieren_anmelden_titel").text(localStorage.Email + " ist angemeldet");
				}

				//Baum aufbauen, wenn Gruppe gewählt wird
				$("body").on("click", "[name='Gruppe']", function () {
					var Gruppe;
					Gruppe = this.value;
					erstelleBaum(Gruppe);
					$("#suchfeld").val("");
					$("#Gruppe_label").html("Gruppe:");
					$("#suchen").hide();
					$("#treeBeschriftung").html("");
					$("#forms").hide();
					$("#suchen").val("");
					$("#tree").html("der Baum wird aufgebaut...");
				});

				//Menu: Links zu Google Bilder und Wikipedia nur aktiv setzen, wenn Art oder Lebensraum angezeigt wird
				$("#menu").on("click", "#menu_btn", function() {
					if ($("#art").html().length > 0) {
						$("#GoogleBilderLink_li").removeClass("disabled");
						$("#WikipediaLink_li").removeClass("disabled");
					} else {
						$("#GoogleBilderLink_li").addClass("disabled");
						$("#WikipediaLink_li").addClass("disabled");
					}
				});

				$("#menu").on("click", "#eigenschaften_importieren", function() {
					zeigeFormular("import");
					if (localStorage.Email) {
						$("#importieren_ds_beschreiben_collapse").collapse('show');
					} else {
						$("#importieren_anmelden_collapse").collapse('show');
					}
				});
				
				//Suche steuern bei Eingabe
				$("#menu").on("keyup click", "#suchfeld", function(e) {
					e.preventDefault();
					//nur automatisch suchen, wenn das schnell ist
					//auf Enter-Taste immer suchen
					if ((this.value.length > 2 && window.baum_laenge < 7000) || e.keyCode === 13) {
						$("#tree").jstree("search", this.value);
					} else if (this.value.length === 0) {
						//Suche beenden, falls Suchfeld leer ist
						$("#tree").jstree("clear_search");
					}
				});

				//Suche steuern bei click auf Suchicon
				$("#menu").on("click", "#suchfeld_icon", function(e) {
					e.preventDefault();
					var suchwert = $("#suchfeld").val();
					if (suchwert) {
						$("#tree").jstree("search", suchwert);
						$("#suchfeld").focus();
					} else {
						//Suche beenden, falls Suchfeld leer ist
						$("#tree").jstree("clear_search");
					}
				});

				$("#menu").on("keyup", "#suchfeld", function() {
					schliesseNichtMarkierteNodes();
				});

				$("#menu").on("click", "#suche_leeren_btn", function() {
					if ($("#suchfeld").val()) {
						$("#suchfeld").val("");
						schliesseNichtMarkierteNodes();
					}
				});

				$(".form").on("keyup focus", "textarea", function() {
					FitToContent(this, document.documentElement.clientHeight);
				});

				//Klick auf Link zu Art steuern
				$(".form").on("click", ".LinkZuArtGleicherGruppe", function(event) {
					var id;
					event.preventDefault();
					id = $(this).attr("artid");
					$("#tree").jstree("clear_search");
					$("#suchen").val("");
					jQuery("#tree").jstree("deselect_all");
					jQuery("#tree").jstree("close_all", -1);
					jQuery("#tree").jstree("select_node", "#" + id);
				});
			});

			$(window).resize(function () {
				setzeTreehoehe();
				setzteHöheTextareas();
			});

			$("#import").on("click", "#anmelden_btn", function(event) {
				event.preventDefault();
				meldeUserAn();
			});

			$("#import").on("keyup", "#Email", function(event) {
				/*allfällig noch vorhandenen Hinweis ausblenden*/
				$("#Emailhinweis").css("display", "none");
			});

			$("#import").on("keyup", "#Passwort", function(event) {
				/*allfällig noch vorhandenen Hinweis ausblenden*/
				$("#Passworthinweis").css("display", "none");
			});

			$("#import").on("keyup", "#Passwort2", function(event) {
				/*allfällig noch vorhandenen Hinweis ausblenden*/
				$("#Passworthinweis2").css("display", "none");
			});

			$("#import").on("click", "#konto_erstellen_btn", function(event) {
				event.preventDefault();
				$(".signup").css("display", "block");
				$("#anmelden_btn").hide();
				$("#konto_erstellen_btn").hide();
				$("#konto_speichern_btn").show();
				setTimeout(function() {
					$("#Email").focus();
				}, 50);  //need to use a timer so that .blur() can finish before you do .focus()
			});

			$("#import").on("click", "#konto_speichern_btn", function(event) {
				event.preventDefault();
				if (validiereSignup()) {
					erstelleKonto();
					//Anmeldefenster zurücksetzen
					$(".signup").css("display", "none");
					$("#anmelden_btn").show();
					$("#konto_erstellen_btn").show();
					$("#konto_speichern_btn").hide();
				}
			});

		</script>
	</body>
	<div id="Meldung"></div>
	
	<div id="meldung_kompatibilität" class="modal hide fade">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			<h3>inkompatibler Browser</h3>
		</div>
		<div class="modal-body">
			<p>Ihr Browser unterstützt nicht alle Funktionen, die ArtenDb benutzt.<br><br>Um mit ArtenDb zu arbeiten, verwenden Sie eine aktuelle Version von z.B. <a href='http://www.google.de/chrome/'>Google Chrome</a> oder <a href='http://www.mozilla.org/de/firefox/new/'>Mozilla Firefox</a>.</p>
		</div>
	</div>
</html>