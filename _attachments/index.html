<!doctype html>
<html lang="de">
	<head>
		<link rel="apple-touch-icon" href="style/images/aster.ico">
		<link rel="icon" href="style/images/aster.ico">
		<meta charset="utf-8">
		<script src="vendor/couchapp/jquery.js"></script>
		<script src="vendor/couchapp/jquery-migrate.js"></script>
		<script src="vendor/couchapp/underscore.js"></script>
		<script src="vendor/couchapp/bootstrap.js"></script>
		<script src="vendor/couchapp/jquery.jstree.js"></script>
		<script src="vendor/couchapp/jquery.cookie.js"></script>
		<script src="vendor/couchapp/jquery.hotkeys.js"></script>
		<script src="vendor/couchapp/jquery.couch.js"></script>
		<script src="vendor/couchapp/jquery.csv.js"></script>
		<script src="vendor/couchapp/jsuri.js"></script>
		<script src="vendor/couchapp/FileSaver.js"></script>
		<script src="vendor/couchapp/sha1.js"></script>
		<script src="vendor/couchapp/artendb.js"></script>
		<link rel="stylesheet" href="style/bootstrap.css">
		<link rel="stylesheet" href="style/artendb.css">
		<script src="vendor/couchapp/modernizr.js"></script>
		<title>ArtenDb</title>
	</head>
	<body>
		<div id="menu_btn" class="btn-group">
			<a class="btn dropdown-toggle btn-inverse" data-toggle="dropdown" href="#">
				Menu
				<span class="caret"></span>
			</a>
			<ul class="dropdown-menu">
				<li class="dropdown-submenu">
					<a tabindex="-1" href="#">Daten importieren / löschen</a>
					<ul class="dropdown-menu">
						<li><a id="ds_importieren" href="#">Eigenschaften</a></li>
						<li><a id="bs_importieren" href="#">Beziehungen</a></li>
					</ul>
				</li>
				<li><a id="exportieren" href="#">Daten exportieren</a></li>
				<li class="dropdown-submenu">
					<a tabindex="-1" href="#">Über diese Anwendung</a>
					<ul class="dropdown-menu">
						<li><a href="https://github.com/barbalex/artendb/blob/master/README.md" target="_blank">Projektbeschreibung</a></li>
						<li><a href="https://github.com/barbalex/artendb" target="_blank">Code</a></li>
						<li><a href="https://github.com/barbalex/artendb/commits/master" target="_blank">Letzte Änderungen</a></li>
						<li><a href="mailto:alex.barbalex@gmail.com">Kontakt</a></li>
					</ul>
				</li>
				<li id="GoogleBilderLink_li" class="disabled"><a id="GoogleBilderLink" href="" target="_blank">Bilder suchen</a></li>
				<li id="WikipediaLink_li" class="disabled"><a id="WikipediaLink" href="" target="_blank">In Wikipedia suchen</a></li>
			</ul>
		</div>
		<fieldset id="menu">
			<div>
				<div id="menu-div">
					<div id="Gruppe_label">Gruppe wählen:</div>
				</div>
				<div id="Gruppe" class="btn-group" data-toggle="buttons-radio">
					<button class="btn btn-inverse gruppe" id="GruppeFauna" value="Fauna">Fauna</button>
					<button class="btn btn-inverse gruppe" id="GruppeFlora" value="Flora">Flora</button>
					<button class="btn btn-inverse gruppe" id="GruppeMoose" value="Moose">Moose</button>
					<button class="btn btn-inverse gruppe" id="GruppeMacromycetes" value="Macromycetes">Pilze</button>
					<button class="btn btn-inverse gruppe" id="GruppeLebensräume" value="Lebensräume">Lebensräume</button>
				</div>
			</div>
			<div id="suchenFauna" class="input-prepend suchen">
				<span class="add-on"><i id="suchfeld_icon" class="icon-search"></i></span><input id="suchfeldFauna" class="span2 suchfeld" type="search" placeholder="filtern">
			</div>
			<div id="suchenFlora" class="input-prepend suchen">
				<span class="add-on"><i id="suchfeld_icon" class="icon-search"></i></span><input id="suchfeldFlora" class="span2 suchfeld" type="search" placeholder="filtern">
			</div>
			<div id="suchenMoose" class="input-prepend suchen">
				<span class="add-on"><i id="suchfeld_icon" class="icon-search"></i></span><input id="suchfeldMoose" class="span2 suchfeld" type="search" placeholder="filtern">
			</div>
			<div id="suchenMacromycetes" class="input-prepend suchen">
				<span class="add-on"><i id="suchfeld_icon" class="icon-search"></i></span><input id="suchfeldMacromycetes" class="span2 suchfeld" type="search" placeholder="filtern">
			</div>
			<div id="suchenLebensräume" class="input-prepend suchen">
				<span class="add-on"><i id="suchfeld_icon" class="icon-search"></i></span><input id="suchfeldLebensräume" class="span2 suchfeld" type="search" placeholder="filtern">
			</div>
			<div id="treeMitteilung" style="display:none;">hole Daten...</div>
			<div id="treeFaunaBeschriftung" class="treeBeschriftung"></div>
			<div id="treeFloraBeschriftung" class="treeBeschriftung"></div>
			<div id="treeMooseBeschriftung" class="treeBeschriftung"></div>
			<div id="treeMacromycetesBeschriftung" class="treeBeschriftung"></div>
			<div id="treeLebensräumeBeschriftung" class="treeBeschriftung"></div>
			<div id="treeFauna" class="baum"></div>
			<div id="treeFlora" class="baum"></div>
			<div id="treeMoose" class="baum"></div>
			<div id="treeMacromycetes" class="baum"></div>
			<div id="treeLebensräume" class="baum"></div>
		</fieldset>

		<fieldset id="forms">

			<form id="art" class="form form-horizontal" action="#" method="get" autocomplete="off">
				<div id="accordion_art" class="accordion">
					<div id="art_anmelden" class="accordion-group" style="display:none;">
						<div class="accordion-heading accordion-group_gradient">
							<a id="art_anmelden_titel" class="accordion-toggle importieren_anmelden_titel" data-toggle="collapse" data-parent="accordion_art" href="#art_anmelden_collapse">Anmelden</a>
						</div>
						<div id="art_anmelden_collapse" class="accordion-body collapse">
							<div class="accordion-inner">
								<div class="well well-small anmelden">Um Daten zu bearbeiten, müssen Sie angemeldet sein.<br>Oder <a href="mailto:alexander.gabriel@bd.zh.ch">Mailen Sie mir</a>, um ein eigenes Login zu erhalten.<br>Während der Testphase können Sie zum testen das folgende Login benutzen: Email = "z@z.ch", Passwort = "z".</div>
								<div class="control-group">
									<label class="control-label Email" for="Email_art">Email</label>
									<div class="controls">
										<input type="email" id="Email_art" class="Email" placeholder="Email" required>
										<div id="Emailhinweis_art" class="Emailhinweis hinweis text-error">Bitte Email erfassen</div>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label Passwort" for="Passwort_art">Passwort</label>
									<div class="controls">
										<input type="password" id="Passwort_art" class="Passwort" placeholder="Passwort" required>
										<div id="Passworthinweis_art" class="Passworthinweis hinweis text-error">Bitte Passwort erfassen</div>
										<div class="signup">Vorsicht: Email und Passwort können später nicht mehr geändert werden!</div>
										<div class="signup">Es wird eine verschlüsselte Version des Passworts gespeichert. Das Original kennt ausser Ihnen niemand.</div>
										<div class="Passwort">Passwort vergessen? <a href="mailto:alexander.gabriel@bd.zh.ch">Mailen Sie mir</a>, möglichst mit derselben email-Adresse, die Sie für das Konto verwenden.</div>
									</div>
								</div>
								<div class="control-group signup">
									<label class="control-label" for="Passwort2_art">Passwort bestätigen</label>
									<div class="controls">
										<input type="password" id="Passwort2_art" class="Passwort2" placeholder="Passwort bestätigen" required>
										<div id="Passwort2hinweis_art" class="Passwort2hinweis hinweis text-error">Bitte Passwort bestätigen</div>
										<div id="Passwort2hinweisFalsch_art" class="Passwort2hinweisFalsch hinweis text-error">Die Passwörter stimmen nicht überein</div>
									</div>
								</div>
								<div class="feld" style="padding-bottom:6px;">
									<button id="anmelden_btn_art" class="btn anmelden_btn">anmelden</button>
									<button id="abmelden_btn_art" class="btn abmelden_btn" style="display:none;">abmelden</button>
									<button id="konto_erstellen_btn_art" class="btn konto_erstellen_btn">neues Konto erstellen</button>
									<button id="konto_speichern_btn_art" class="btn konto_speichern_btn" style="display:none;">neues Konto speichern</button>
								</div>
								<div id="art_anmelden_fehler" class="alert alert-error importieren_anmelden_fehler">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="art_anmelden_fehler_text" class="importieren_anmelden_fehler_text"></div>
								</div>
								<div id="art_anmelden_hinweis" class="alert alert-info importieren_anmelden_hinweis">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="art_anmelden_hinweis_text" class="importieren_anmelden_hinweis_text"></div>
								</div>
							</div>
						</div>
					</div>
					<div id="art_inhalt"></div>
				</div>
			</form>
			
			<form id="importieren_ds" class="form form-horizontal import" action="#" method="get" autocomplete="off">
				<div id="importieren_ds_accordion" class="accordion">
					<div id="importieren_ds_anmelden" class="accordion-group importieren_anmelden">
						<div class="accordion-heading accordion-group_gradient">
							<a id="importieren_ds_anmelden_titel" class="accordion-toggle importieren_anmelden_titel" data-toggle="collapse" data-parent="importieren_ds_accordion" href="#importieren_ds_anmelden_collapse">1. Anmelden</a>
						</div>
						<div id="importieren_ds_anmelden_collapse" class="accordion-body collapse importieren_anmelden_collapse">
							<div class="accordion-inner">
								<div class="well well-small anmelden">Um Daten zu bearbeiten, müssen Sie angemeldet sein.<br>Oder <a href="mailto:alexander.gabriel@bd.zh.ch">Mailen Sie mir</a>, um ein eigenes Login zu erhalten.<br>Während der Testphase können Sie zum testen das folgende Login benutzen: Email = "z@z.ch", Passwort = "z".</div>
								<div class="control-group">
									<label class="control-label Email" for="Email_ds">Email</label>
									<div class="controls">
										<input type="email" id="Email_ds" class="Email" placeholder="Email" required>
										<div id="Emailhinweis_ds" class="hinweis text-error Emailhinweis">Bitte Email erfassen</div>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label Passwort" for="Passwort_ds">Passwort</label>
									<div class="controls">
										<input type="password" id="Passwort_ds" class="Passwort" placeholder="Passwort" required>
										<div id="Passworthinweis_ds" class="hinweis text-error">Bitte Passwort erfassen</div>
										<div class="signup">Vorsicht: Email und Passwort können später nicht mehr geändert werden!</div>
										<div class="signup">Es wird eine verschlüsselte Version des Passworts gespeichert. Das Original kennt ausser Ihnen niemand.</div>
										<div class="Passwort">Passwort vergessen? <a href="mailto:alexander.gabriel@bd.zh.ch">Mailen Sie mir</a>, möglichst mit derselben email-Adresse, die Sie für das Konto verwenden.</div>
									</div>
								</div>
								<div class="control-group signup">
									<label class="control-label" for="Passwort2_ds">Passwort bestätigen</label>
									<div class="controls">
										<input type="password" id="Passwort2_ds" class="Passwort2" placeholder="Passwort bestätigen" required>
										<div id="Passwort2hinweis_ds" class="hinweis text-error Passwort2hinweis">Bitte Passwort bestätigen</div>
										<div id="Passwort2hinweisFalsch_ds" class="hinweis text-error Passwort2hinweisFalsch">Die Passwörter stimmen nicht überein</div>
									</div>
								</div>
								<div class="feld" style="padding-bottom:6px;">
									<button id="anmelden_btn_ds" class="btn anmelden_btn">anmelden</button>
									<button id="abmelden_btn_ds" class="btn abmelden_btn" style="display:none;">abmelden</button>
									<button id="konto_erstellen_btn_ds" class="btn konto_erstellen_btn">neues Konto erstellen</button>
									<button id="konto_speichern_btn_ds" class="btn konto_speichern_btn" style="display:none;">neues Konto speichern</button>
								</div>
								<div id="importieren_ds_anmelden_fehler" class="alert alert-error importieren_anmelden_fehler">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_ds_anmelden_fehler_text" class="importieren_anmelden_fehler_text"></div>
								</div>
								<div id="importieren_ds_anmelden_hinweis" class="alert alert-info importieren_anmelden_hinweis">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_ds_anmelden_hinweis_text" class="importieren_anmelden_hinweis_text"></div>
								</div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_ds_ds_beschreiben">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="importieren_ds_accordion" href="#importieren_ds_ds_beschreiben_collapse">
								2. Datensammlung beschreiben
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_ds_ds_beschreiben_collapse">
							<div class="accordion-inner">
								<div class="well well-small">Bitte erleichtern Sie den Benutzern, Ihre Daten zu verstehen:
									<ul>
										<li>Der Name sollte ca. dem ersten Teil eines Literaturzitats entsprechen. Beispiel: "Blaue Liste (1998)"</li>
										<li>Wurden die Informationen spezifisch für einen bestimmten Kanton oder die ganze Schweiz erarbeitet? Wenn ja: Bitte das entsprechende Kürzel voranstellen. Beispiel: "ZH Artwert (1995)"</li>
										<li>Die Beschreibung sollte im ersten Teil etwa einem klassischen Literaturzitat entsprechen. Beispiel: "Gigon A. et al. (1998): Blaue Listen der erfolgreich erhaltenen oder geförderten Tier- und Pflanzenarten der Roten Listen. Methodik und Anwendung in der nördlichen Schweiz. Veröff. Geobot. Inst. ETH, Stiftung Rübel, Zürich 129: 1-137 + 180 pp. Appendicesn"</li>
										<li>In einem zweiten Teil sollte beschrieben werden, welche Informationen die Datensammlung enthält. Beispiel: "Eigenschaften von 207 Tierarten und 885 Pflanzenarten"</li>
										<li>Es kann hilfreich sein, den Zweck zu beschreiben, für den die Informationen zusammengestellt wurden</li>
										<li>Im Datenstand ist erkenntlich, wann die Datensammlung zuletzt aktualisiert wurde</li>
										<li>Besonders hilfreich ist es, wann die Originalpublikation verlinkt werden kann. Oder eine erläuternde Webseite</li>
									</ul>
								</div>
								<div class="well well-small">Wenn eine zusammenfassende Datensammlung erstellt werden soll, sind die Daten zwei mal zu importieren:
									<ul>
										<li>zuerst in die Ursprungs-Datensammlung</li>
										<li>dann in die zusammenfassende. Bitte die Ursprungs-Datensammlung angeben</li>
									</ul>
								</div>
								<div class="well well-small">Autorenrechte beachten:
									<ul>
										<li>Die Autoren müssen mit der Veröffentlichung einverstanden sein</li>
										<li>Dafür verantwortlich ist, wer Daten importiert</li>
									</ul>
								</div>
								<div class="control-group">
									<label class="control-label" for="DsWaehlen">Bestehende wählen</label>
									<select type="text" class="controls" id="DsWaehlen"></select>
								</div>
								<div class="feld">
									<button type="button" class="btn" id="DsLoeschen" style="display:none; margin-bottom:6px;">Gewählte Datensammlung und alle ihre Eigenschaften aus allen Arten und/oder Lebensräumen entfernen</button>
									<div id="importieren_ds_ds_beschreiben_hinweis" class="alert alert-info">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_ds_ds_beschreiben_hinweis_text"></div>
								</div>
								</div>
								<hr>
								<div class="control-group">
									<label class="control-label" for="DsName">Name</label>
									<input type="text" class="controls" id="DsName">
								</div>
								<div class="control-group">
									<label class="control-label" for="DsBeschreibung">Beschreibung</label>
									<textarea class="controls" id="DsBeschreibung"></textarea>
								</div>
								<div class="control-group">
									<label class="control-label" for="DsDatenstand">Datenstand</label>
									<textarea class="controls" id="DsDatenstand"></textarea>
								</div>
								<div class="control-group">
									<label class="control-label" for="DsLink">Link</label>
									<textarea class="controls" id="DsLink"></textarea>
								</div>
								<div class="control-group">
									<label class="control-label" for="DsImportiertVon">importiert von</label>
									<input type="text" class="controls" id="DsImportiertVon">
								</div>
								<div class="control-group">
									<label class="control-label" for="DsZusammenfassend">zusammenfassend</label>
									<input class="controls" type="checkbox" id="DsZusammenfassend">
								</div>
								<div class="control-group" id="DsUrsprungsDs_div" style="display:none;">
									<label class="control-label DsUrsprungsDs" for="DsUrsprungsDs" id="DsUrsprungsDs_label">Ursprungs-Datensammlung</label>
									<select type="text" class="controls DsUrsprungsDs" id="DsUrsprungsDs"></select>
								</div>
								<div class="control-group">
									<label class="control-label" for="DsAnzDs" id="DsAnzDs_label"></label>
									<div id="DsAnzDs" class="feldtext controls"></div>
								</div>
								<div id="importieren_ds_ds_beschreiben_hinweis2" class="alert alert-info">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_ds_ds_beschreiben_hinweis_text2"></div>
								</div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_ds_daten_uploaden">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="importieren_ds_accordion" href="#importieren_ds_daten_uploaden_collapse">
								3. Eigenschaften laden
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_ds_daten_uploaden_collapse">
							<div class="accordion-inner">
								<div class="well well-small">Technische Anforderungen an die Datei:
									<ul>
										<li>Die erste Zeile enthält die Feldnamen</li>
										<li>Die weiteren Zeilen enthalten je einen Datensatz, d.h. die Eigenschaften für die betreffende Art oder den Lebensraum</li>
										<li>Alle Zeilen sollten dieselbe Anzahl Felder bzw. Spalten enthalten</li>
										<li>Zeilen werden mit einem Zeilenumbruch getrennt</li>
										<li>Der Inhalt eines Felds bzw. einer Spalte sollte in der Regel in Anführungs- und Schlusszeichen eingefasst sein, z.B.: "Artwert"</li>
										<li>Ausnahmen: Zahlen und true/false-Werte brauchen keine Anführungs- und Schlusszeichen (es macht aber nichts, wenn sie sie haben)</li>
										<li>Achten Sie darauf, dass die Datei die Codierung "UTF 8" benutzt. Nur in diesem Format werden Umlaute und Sonderzeichen vollständig erkannt</li>
										<li>Die oben beschriebenen Anforderungen entsprechen der am häufigsten verwendeten Konfiguration des <a href="http://de.wikipedia.org/wiki/CSV_(Dateiformat)">"csv"-Formats</a></li>
									</ul>
								</div>
								<div class="well well-small">Inhaltliche Anforderungen:
									<ul>
										<li>Um die Art oder den Lebensraum zu identifizieren müssen Sie eine ID mitliefern. Entweder die GUID der ArtenDb. Oder die vom entsprechenden nationalen Artdatenzentrum für diese Artengruppe verwendete ID (z.B. Flora: SISF-Nr)</li>
										<li>Sie haben bloss eine andere ID? Vielleicht finden Sie sie in einer Datensammlung der ArtenDb. Beispielsweise enthält die Flora Indicativa (= "CH Zeigerwerte (2010)") mehrere weitere ID's aus anderen Florenwerken. Sie können diese Daten gemeinsam mit der GUID der ArtenDb exportieren (z.B. ins Excel-Arbeitsblatt "ID-Liste"). Danach können Sie z.B. in Excel in der Spalte neben ihrer ID mithilfe der Funktion "SVERWEIS" die jeweilige GUID der ArtenDb einfügen. Die Funktion "SVERWEIS" schlägt dabei in der "ID-Liste" für ihre ID die GUID nach</li>
										<li>Achten Sie bitte darauf, die Feldnamen und die enthaltenen Werte uncodiert und aussagekräftig zu gestalten. Auch Nutzer ohne Spezialwissen sollten sie verstehen können</li>
										<li>Sind für Ihre Daten Codierungen wichtig? Dann importieren Sie die Daten doch einfach in zwei Felder: Eines codiert, das andere uncodiert. Und ergänzen Sie Ihre Feldnamen mit den Zusätzen "codiert" bzw. "uncodiert"</li>
										<li>ArtenDb setzt beim Export von Daten den Namen der Datensammlung vor den Feldnamen, z.B.: "ZH FNS (aktuell): Artwert". Das erleichtert das Verständnis der Daten in der "flachen" Tabelle. Beim Import hingegen ist es NICHT sinnvoll, die Felder so zu nennen. Denn den Namen der Datensammlung haben Sie im letzten Arbeitsschritt schon erfasst und er wird den Daten beim Import in hierarchischer Form mitgegeben</li>
									</ul>
								</div>
								<div class="form-actions">
									<div class="fileupload fileupload-new" data-provides="fileupload">
										<div class="input-append">
											<div class="uneditable-input span3"><i class="icon-file fileupload-exists"></i> <span class="fileupload-preview"></span></div><span class="btn btn-file"><span class="fileupload-new">Datei wählen</span><span class="fileupload-exists">neue Datei wählen</span><input type="file" id="DsFile" /></span><a href="#" class="btn fileupload-exists" data-dismiss="fileupload">Datei entfernen</a>
										</div>
									</div>
								</div>
								<div id="DsTabelleEigenschaften" class="tabelle">
								</div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_ds_ids_identifizieren">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="importieren_ds_accordion" href="#importieren_ds_ids_identifizieren_collapse">
								4. ID's identifizieren
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_ds_ids_identifizieren_collapse">
							<div class="accordion-inner">
								<div id="DsFelder_div" class="control-group"></div>
								<div class="control-group">
									<label class="control-label" for="DsId">zugehörige ID in ArtenDb</label>
									<select type="text" class="controls" id="DsId"  multiple="multiple" style="height:95px;">
										<option value="guid">GUID der ArtenDb</option>
										<option value="Fauna">ID der Info Fauna (NUESP)</option>
										<option value="Flora">ID der Info Flora (SISF-NR)</option>
										<option value="Moose">ID des Datenzentrums Moose Schweiz (TAXONNO)</option>
										<option value="Macromycetes">ID von Swissfungi (TaxonId)</option>
									</select>
								</div>
								<div id="importieren_ds_ids_identifizieren_fehler" class="alert alert-error">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_ds_ids_identifizieren_fehler_text"></div>
								</div>
								<div id="importieren_ds_ids_identifizieren_hinweis" class="alert alert-info">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_ds_ids_identifizieren_hinweis_text"></div>
								</div>
								<div id="importieren_ds_ids_identifizieren_erfolg" class="alert alert-success">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_ds_ids_identifizieren_erfolg_text"></div>
								</div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_ds_import_ausfuehren">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="importieren_ds_accordion" href="#importieren_ds_import_ausfuehren_collapse">
								5. Import ausführen
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_ds_import_ausfuehren_collapse">
							<div class="accordion-inner">
								<button type="button" class="btn" id="DsImportieren" style="margin-bottom:6px; display:none;">Datensammlung mit allen Eigenschaften importieren</button>
								<button type="button" class="btn" id="DsEntfernen" style="margin-bottom:6px; display:none;">Datensammlung mit allen Eigenschaften aus den in der geladenen Datei enthaltenen Arten/Lebensräumen entfernen</button>
								<div id="importieren_ds_import_ausfuehren_hinweis" class="alert alert-info">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_ds_import_ausfuehren_hinweis_text"></div>
								</div>
							</div>
						</div>
					</div>
				</div>		
			</form>

			<form id="importieren_bs" class="form form-horizontal import" action="#" method="get" autocomplete="off">
				<div id="importieren_bs_accordion" class="accordion">
					<div id="importieren_bs_anmelden" class="accordion-group">
						<div class="accordion-heading accordion-group_gradient">
							<a id="importieren_bs_anmelden_titel" class="accordion-toggle importieren_anmelden_titel" data-toggle="collapse" data-parent="importieren_bs_accordion" href="#importieren_bs_anmelden_collapse">1. Anmelden</a>
						</div>
						<div id="importieren_bs_anmelden_collapse" class="accordion-body collapse">
							<div class="accordion-inner">
								<div class="well well-small anmelden">Um Daten zu bearbeiten, müssen Sie angemeldet sein.<br>Oder <a href="mailto:alexander.gabriel@bd.zh.ch">Mailen Sie mir</a>, um ein eigenes Login zu erhalten.<br>Während der Testphase können Sie zum testen das folgende Login benutzen: Email = "z@z.ch", Passwort = "z".</div>
								<div class="control-group">
									<label class="control-label Email" for="Email_bs">Email</label>
									<div class="controls">
										<input type="email" id="Email_bs" class="Email" placeholder="Email" required>
										<div id="Emailhinweis_bs" class="Emailhinweis hinweis text-error">Bitte Email erfassen</div>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label Passwort" for="Passwort_bs">Passwort</label>
									<div class="controls">
										<input type="password" id="Passwort_bs" class="Passwort" placeholder="Passwort" required>
										<div id="Passworthinweis_bs" class="Passworthinweis hinweis text-error">Bitte Passwort erfassen</div>
										<div class="signup">Vorsicht: Email und Passwort können später nicht mehr geändert werden!</div>
										<div class="signup">Es wird eine verschlüsselte Version des Passworts gespeichert. Das Original kennt ausser Ihnen niemand.</div>
										<div class="Passwort">Passwort vergessen? <a href="mailto:alexander.gabriel@bd.zh.ch">Mailen Sie mir</a>, möglichst mit derselben email-Adresse, die Sie für das Konto verwenden.</div>
									</div>
								</div>
								<div class="control-group signup">
									<label class="control-label" for="Passwort2_bs">Passwort bestätigen</label>
									<div class="controls">
										<input type="password" id="Passwort2_bs" class="Passwort2" placeholder="Passwort bestätigen" required>
										<div id="Passwort2hinweis_bs" class="Passwort2hinweis hinweis text-error">Bitte Passwort bestätigen</div>
										<div id="Passwort2hinweisFalsch_bs" class="Passwort2hinweisFalsch hinweis text-error">Die Passwörter stimmen nicht überein</div>
									</div>
								</div>
								<div class="feld" style="padding-bottom:6px;">
									<button id="anmelden_btn_bs" class="btn anmelden_btn">anmelden</button>
									<button id="abmelden_btn_bs" class="btn abmelden_btn" style="display:none;">abmelden</button>
									<button id="konto_erstellen_btn_bs" class="btn konto_erstellen_btn">neues Konto erstellen</button>
									<button id="konto_speichern_btn_bs" class="btn konto_speichern_btn" style="display:none;">neues Konto speichern</button>
								</div>
								<div id="importieren_bs_anmelden_fehler" class="alert alert-error importieren_anmelden_fehler">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_bs_anmelden_fehler_text" class="importieren_anmelden_fehler_text"></div>
								</div>
								<div id="importieren_bs_anmelden_hinweis" class="alert alert-info importieren_anmelden_hinweis">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_bs_anmelden_hinweis_text" class="importieren_anmelden_hinweis_text"></div>
								</div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_bs_ds_beschreiben">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="importieren_bs_accordion" href="#importieren_bs_ds_beschreiben_collapse">
								2. Beziehungssammlung beschreiben
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_bs_ds_beschreiben_collapse">
							<div class="accordion-inner">
								<div class="well well-small">Bitte erleichtern Sie den Benutzern, Ihre Daten zu verstehen:
									<ul>
										<li>Der erste Teil des Namens sollte ca. dem ersten Teil eines Literaturzitats entsprechen. Beispiel: "Delarze (2008)"</li>
										<li>Danach sollte der Namen die Art der Beziehung ausdrücken. Beispiel: "Delarze (2008): Art charakterisiert Lebensraum"</li>
										<li>Wurden die Informationen spezifisch für einen bestimmten Kanton oder die ganze Schweiz erarbeitet? Wenn ja: Bitte das entsprechende Kürzel voranstellen. Beispiel: "CH Delarze (2008): Art charakterisiert Lebensraum"</li>
										<li>Die Beschreibung sollte im ersten Teil etwa einem klassischen Literaturzitat entsprechen. Beispiel: "Delarze R. & Gonseth Y. (2008): Lebensräume der Schweiz"</li>
										<li>In einem zweiten Teil sollte beschrieben werden, welche Informationen die Datensammlung enthält. Beispiel: "Delarze R. & Gonseth Y. (2008): Lebensräume der Schweiz. 791 Beziehungen zwischen 279 Lebensräumen und Tierarten"</li>
										<li>Es kann hilfreich sein, den Zweck zu beschreiben, für den die Informationen zusammengestellt wurden</li>
										<li>Im Datenstand ist erkenntlich, wann die Datensammlung zuletzt aktualisiert wurde</li>
										<li>Besonders hilfreich ist es, wann die Originalpublikation verlinkt werden kann. Oder eine erläuternde Webseite</li>
									</ul>
								</div>
								<div class="well well-small">Wenn eine zusammenfassende Beziehungssammlung erstellt werden soll, sind die Daten zwei mal zu importieren:
									<ul>
										<li>zuerst in die Ursprungs-Beziehungssammlung</li>
										<li>dann in die zusammenfassende. Bitte die Ursprungs-Beziehungssammlung angeben</li>
									</ul>
								</div>
								<div class="well well-small">Autorenrechte beachten:
									<ul>
										<li>Die Autoren müssen mit der Veröffentlichung einverstanden sein</li>
										<li>Dafür verantwortlich ist, wer Daten importiert</li>
									</ul>
								</div>
								<div class="control-group">
									<label class="control-label" for="BsWaehlen">Bestehende wählen</label>
									<select type="text" class="controls" id="BsWaehlen"></select>
								</div>
								<div class="feld">
									<button type="button" class="btn" id="BsLoeschen" style="display:none; margin-bottom:6px;">Gewählte Beziehungssammlung und alle ihre Eigenschaften aus allen Arten und/oder Lebensräumen entfernen</button>
									<div id="importieren_bs_ds_beschreiben_hinweis" class="alert alert-info">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_bs_ds_beschreiben_hinweis_text"></div>
								</div>
								</div>
								<hr>
								<div class="control-group">
									<label class="control-label" for="BsName">Name</label>
									<input type="text" class="controls" id="BsName">
								</div>
								<div class="control-group">
									<label class="control-label" for="BsBeschreibung">Beschreibung</label>
									<textarea class="controls" id="BsBeschreibung"></textarea>
								</div>
								<div class="control-group">
									<label class="control-label" for="BsDatenstand">Datenstand</label>
									<textarea class="controls" id="BsDatenstand"></textarea>
								</div>
								<div class="control-group">
									<label class="control-label" for="BsLink">Link</label>
									<textarea class="controls" id="BsLink"></textarea>
								</div>
								<div class="control-group">
									<label class="control-label" for="BsImportiertVon">importiert von</label>
									<input type="text" class="controls" id="BsImportiertVon">
								</div>
								<div class="control-group">
									<label class="control-label" for="BsZusammenfassend">zusammenfassend</label>
									<input class="controls" type="checkbox" id="BsZusammenfassend">
								</div>
								<div class="control-group" id="BsUrsprungsBs_div" style="display:none;">
									<label class="control-label BsUrsprungsBs" for="BsUrsprungsBs" id="BsUrsprungsBs_label">Ursprungs-Datensammlung</label>
									<select type="text" class="controls BsUrsprungsBs" id="BsUrsprungsBs"></select>
								</div>
								<div class="control-group">
									<label class="control-label" for="BsAnzDs" id="BsAnzDs_label"></label>
									<div id="BsAnzDs" class="feldtext controls"></div>
								</div>
								<div id="importieren_bs_ds_beschreiben_hinweis2" class="alert alert-info">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_bs_ds_beschreiben_hinweis_text2"></div>
								</div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_bs_daten_uploaden">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="importieren_bs_accordion" href="#importieren_bs_daten_uploaden_collapse">
								3. Beziehungen laden
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_bs_daten_uploaden_collapse">
							<div class="accordion-inner">
								<div class="well well-small">Technische Anforderungen an die Datei:
									<ul>
										<li>Die erste Zeile enthält die Feldnamen</li>
										<li>Die weiteren Zeilen enthalten je einen Datensatz, d.h. eine Beziehung für die betreffende Art oder den Lebensraum</li>
										<li>Alle Zeilen sollten dieselbe Anzahl Felder bzw. Spalten enthalten</li>
										<li>Zeilen werden mit einem Zeilenumbruch getrennt</li>
										<li>Der Inhalt eines Felds bzw. einer Spalte sollte in der Regel in Anführungs- und Schlusszeichen eingefasst sein, z.B.: "Beziehungspartner"</li>
										<li>Ausnahmen: Zahlen und true/false-Werte brauchen keine Anführungs- und Schlusszeichen (es macht aber nichts, wenn sie sie haben)</li>
										<li>Achten Sie darauf, dass die Datei die Codierung "UTF 8" benutzt. Nur in diesem Format werden Umlaute und Sonderzeichen vollständig erkannt</li>
										<li>Die oben beschriebenen Anforderungen entsprechen der am häufigsten verwendeten Konfiguration des <a href="http://de.wikipedia.org/wiki/CSV_(Dateiformat)">"csv"-Formats</a></li>
									</ul>
								</div>
								<div class="well well-small">Inhaltliche Anforderungen:
									<ul>
										<li>Um die zu beschreibende Art oder den Lebensraum zu identifizieren müssen Sie eine ID mitliefern. Entweder die GUID der ArtenDb. Oder die vom entsprechenden nationalen Artdatenzentrum für diese Artengruppe verwendete ID (z.B. Flora: SISF-Nr)</li>
										<li>Sie haben bloss eine andere ID? Vielleicht finden Sie sie in einer Datensammlung der ArtenDb. Beispielsweise enthält die Flora Indicativa (= "CH Zeigerwerte (2010)") mehrere weitere ID's aus anderen Florenwerken. Sie können diese Daten gemeinsam mit der GUID der ArtenDb exportieren (z.B. ins Excel-Arbeitsblatt "ID-Liste"). Danach können Sie z.B. in Excel in der Spalte neben ihrer ID mithilfe der Funktion "SVERWEIS" die jeweilige GUID der ArtenDb einfügen. Die Funktion "SVERWEIS" schlägt dabei in der "ID-Liste" für ihre ID die GUID nach</li>
										<li>Es braucht ein Feld namens "Beziehungspartner". Dieses muss jeweils ein oder mehrere GUID's der ArtenDb enthalten (andere ID's werden hier - zumindest vorläufig - nicht erkannt)</li>
										<li>Es können beliebig viele weitere, die Beziehung beschreibende Felder enthalten sein</li>
										<li>Achten Sie bitte darauf, die Feldnamen und die enthaltenen Werte uncodiert und aussagekräftig zu gestalten. Auch Nutzer ohne Spezialwissen sollten sie verstehen können</li>
										<li>Sind für Ihre Daten Codierungen wichtig? Dann importieren Sie die Daten doch einfach in zwei Felder: Eines codiert, das andere uncodiert. Und ergänzen Sie Ihre Feldnamen mit den Zusätzen "codiert" bzw. "uncodiert"</li>
										<li>ArtenDb setzt beim Export von Daten den Namen der Datensammlung vor den Feldnamen, z.B.: "ZH FNS (aktuell): Artwert". Das erleichtert das Verständnis der Daten in der "flachen" Tabelle. Beim Import hingegen ist es NICHT sinnvoll, die Felder so zu nennen. Denn den Namen der Datensammlung haben Sie im letzten Arbeitsschritt schon erfasst und er wird den Daten beim Import in hierarchischer Form mitgegeben</li>
									</ul>
								</div>
								<div class="form-actions">
									<div class="fileupload fileupload-new" data-provides="fileupload">
										<div class="input-append">
											<div class="uneditable-input span3"><i class="icon-file fileupload-exists"></i> <span class="fileupload-preview"></span></div><span class="btn btn-file"><span class="fileupload-new">Datei wählen</span><span class="fileupload-exists">neue Datei wählen</span><input type="file" id="BsFile" /></span><a href="#" class="btn fileupload-exists" data-dismiss="fileupload">Datei entfernen</a>
										</div>
									</div>
								</div>
								<div id="BsTabelleEigenschaften" class="tabelle">
								</div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_bs_ids_identifizieren">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="importieren_bs_accordion" href="#importieren_bs_ids_identifizieren_collapse">
								4. ID's identifizieren
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_bs_ids_identifizieren_collapse">
							<div class="accordion-inner">
								<div id="BsFelder_div" class="control-group"></div>
								<div class="control-group">
									<label class="control-label" for="BsId">zugehörige ID in ArtenDb</label>
									<select type="text" class="controls" id="BsId"  multiple="multiple" style="height:95px;">
										<option value="guid">GUID der ArtenDb</option>
										<option value="Fauna">ID der Info Fauna (NUESP)</option>
										<option value="Flora">ID der Info Flora (SISF-NR)</option>
										<option value="Moose">ID des Datenzentrums Moose Schweiz (TAXONNO)</option>
										<option value="Macromycetes">ID von Swissfungi (TaxonId)</option>
									</select>
								</div>
								<div id="importieren_bs_ids_identifizieren_fehler" class="alert alert-error">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_bs_ids_identifizieren_fehler_text"></div>
								</div>
								<div id="importieren_bs_ids_identifizieren_hinweis" class="alert alert-info">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_bs_ids_identifizieren_hinweis_text"></div>
								</div>
								<div id="importieren_bs_ids_identifizieren_erfolg" class="alert alert-success">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_bs_ids_identifizieren_erfolg_text"></div>
								</div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="importieren_bs_import_ausfuehren">
						<div class="accordion-heading accordion-group_gradient">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="importieren_bs_accordion" href="#importieren_bs_import_ausfuehren_collapse">
								5. Import ausführen
							</a>
						</div>
						<div class="accordion-body collapse" id="importieren_bs_import_ausfuehren_collapse">
							<div class="accordion-inner">
								<button type="button" class="btn" id="BsImportieren" style="margin-bottom:6px;">Beziehungssammlung mit allen Eigenschaften importieren</button>
								<button type="button" class="btn" id="BsEntfernen" style="margin-bottom:6px;">Beziehungssammlung mit allen Eigenschaften aus den in der geladenen Datei enthaltenen Arten/Lebensräumen entfernen</button>
								<div id="importieren_bs_import_ausfuehren_hinweis" class="alert alert-info">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="importieren_bs_import_ausfuehren_hinweis_text"></div>
								</div>
							</div>
						</div>
					</div>
				</div>		
			</form>

			<form id="export" class="form form-horizontal" action="#" method="get" autocomplete="off">
				<div class="accordion" id="exportieren_accordion">
					<div class="accordion-group" id="exportieren_objekte_waehlen_gruppen">
						<div class="accordion-heading accordion-group_gradient">
							<a id="exportieren_objekte_waehlen_gruppen_titel" class="accordion-toggle" data-toggle="collapse" data-target="#exportieren_objekte_waehlen_gruppen_collapse" data-parent="exportieren_accordion" href="#exportieren_objekte_waehlen_gruppen_collapse">1. Gruppe(n) wählen</a>
						</div>
						<div class="accordion-body collapse in" id="exportieren_objekte_waehlen_gruppen_collapse">
							<div class="accordion-inner">
								<div class="well well-small">So geht's:
									<ul>
										<li>Wählen Sie eine oder mehrere Gruppen</li>
										<li>Danach werden die Eigenschaften der Gruppe(n) aufgebaut...</li>
										<li>...und Sie können filtern und Eigenschaften wählen</li>
										<li>Mit der Schaltfläche "Alle Taxonomien zusammenfassen" werden alle in den gewählten Gruppen vorkommenden Taxonomien unter dem Titel "Taxonomie(n)" zusammegefasst und alle vorkommenden Felder aufgelistet
											<ul>
												<li>Das ist vor allem für Lebensräume interessant: Jeder Lebensraumschlüssel stellt eine Taxonomie dar und oft haben sie dieselben Felder.
												<br>Filtern Sie beispielsweise im Feld "Taxonomie" nach "Delarze", können Sie alle Informationen von Delarze gleichzeitig exportieren</li>
											<li>Sie können so auch Arten aus mehreren Gruppen exportieren und dabei den vollständigen Artnamen ins selbe Feld schreiben</li>
											</ul>
										</li>
									</ul>
								</div>
								<label class="checkbox">
									<input class="exportieren_ds_objekte_waehlen_gruppe" type="checkbox" view="fauna" value="Fauna">Fauna
								</label>
								<label class="checkbox">
									<input class="exportieren_ds_objekte_waehlen_gruppe" type="checkbox" view="flora" value="Flora">Flora
								</label>
								<label class="checkbox">
									<input class="exportieren_ds_objekte_waehlen_gruppe" type="checkbox" view="moose" value="Moose">Moose
								</label>
								<label class="checkbox">
									<input class="exportieren_ds_objekte_waehlen_gruppe" type="checkbox" view="macromycetes" value="Macromycetes">Pilze
								</label>
								<label class="checkbox">
									<input class="exportieren_ds_objekte_waehlen_gruppe" type="checkbox" view="lr" value="Lebensräume">Lebensräume
								</label>
								<button id="exportieren_objekte_Taxonomien_zusammenfassen" type="button" class="btn" data-toggle="button" style="margin-bottom:9px;">Alle Taxonomien zusammenfassen</button>
								<div id="exportieren_objekte_waehlen_gruppen_hinweis" class="alert alert-info">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="exportieren_objekte_waehlen_gruppen_hinweis_text"></div>
								</div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="exportieren_objekte_waehlen_ds">
						<div class="accordion-heading accordion-group_gradient">
							<a id="exportieren_objekte_waehlen_ds_titel" class="accordion-toggle" data-toggle="collapse" data-target="#exportieren_objekte_waehlen_ds_collapse" data-parent="exportieren_accordion" href="#exportieren_objekte_waehlen_ds_collapse">2. Nach Eigenschaften filtern</a>
						</div>
						<div class="accordion-body collapse" id="exportieren_objekte_waehlen_ds_collapse">
							<div class="accordion-inner">
								<div class="well well-small" style="margin-bottom:15px;">So geht's:
									<ul>
										<li>Nachfolgend sind alle Eigenschaften aufgelistet, die in den gewählten Gruppen vorkommen</li>
										<li>Erfassen Sie in den Eigenschaften Ihrer Wahl die gewünschten Kriterien...</li>
										<li>...und wählen Sie danach unter "3. Eigenschaften wählen", welche Eigenschaften exportiert werden sollen</li>
									</ul>
									<p>Tipps zum Filtern:</p>
									<ul>
										<li>Sie können nach beliebig vielen Eigenschaften filtern. Jedes Kriterium reduziert die Anzahl "Treffer"
											<br>Beispiel: Filtern Sie im Namen nach "Eisvogel" und in der Ordnung nach "Lepidoptera", erhalten Sie drei Schmetterlinge aber nicht den entsprechenden Vogel</li>
										<li>Sie möchten nach "Schmetterlinge" oder "Vögel" suchen? Exportieren Sie zuerst "Schmetterlinge", danach die "Vögel" und setzen die zwei Exporte zusammen</li>
										<li>Es kommt nicht auf Gross-/Kleinschreibung an
											<br>Beispiel: Schreiben Sie "eisvogel", wird auch "Eisvogel" gefunden</li>
										<li>Sie können nach einem Teil des Feldinhalts filtern (wenn Sie keine Vergleichsoperatoren verwenden)
											<br>Beispiel: Schreiben Sie "Vogel", wird auch "Eisvogel" gefunden</li>
										<li>Sie können die folgenden Vergleichsoperatoren verwenden: "=", ">", ">=", "<", "<="
											<br>Beispiel 1: Schreiben Sie im Feld "Artwert" ">5", werden Arten mit Artwert ab 6 gefunden
											<br>Beispiel 2: Schreiben Sie "=Vogel", wird nur "Vogel" gefunden, nicht aber "Eisvogel"</li>
										<li>Sie möchten nach einem Feld filtern, das entweder "ja" oder "nein", "wahr" oder "falsch" ist? Verwenden Sie die Englischen Begriffe "true" und "false" (ohne Hochzeichen)</li>
										<li>Was (noch) NICHT funktioniert: Wenn Sie nach zwei oder mehr Eigenschaften derselben Beziehungssammlung filtern und eines davon ist "Beziehungspartner", erhalten Sie zuviele Resultate. Filtern Sie hier also bloss nach einer Eigenschaft und im exportierten Resultat nach der zweiten</li>
									</ul>
								</div>
								<label class="checkbox">
									<input type="checkbox" id="exportieren_nur_ds" checked>
									Wenn Informationen aus Daten- und beziehungssammlungen gewählt werden:<br>Nur Datensätze mit Informationen aus den gewählten Daten- und Beziehungssammlungen exportieren.<br>Entfernen Sie diese Option, um auch Datensätze zu exportieren, die nur Informationen aus Art/Lebensraum und Taxonomie enthalten.
								</label>
								<hr>
								<div class="control-group">
									<h3>Art / Lebensraum</h3>
								</div>
								<div class="control-group">
									<label class="control-label" for="exportieren_objekte_waehlen_ds_guid">GUID</label>
									<div class="controls">
										<input class="export_feld_filtern" type="text" id="exportieren_objekte_waehlen_ds_guid" Eigenschaft="Objekt" Feld="_id">
									</div>
								</div>
								<div id="exportieren_objekte_waehlen_ds_felderliste"></div>
							</div>
						</div>
					</div>

					<div class="accordion-group" id="exportieren_felder_waehlen">
						<div class="accordion-heading accordion-group_gradient">
							<a id="exportieren_felder_waehlen_titel" class="accordion-toggle" data-toggle="collapse" data-target="#exportieren_felder_waehlen_collapse" data-parent="exportieren_accordion" href="#exportieren_felder_waehlen_collapse">3. Eigenschaften wählen</a>
						</div>
						<div class="accordion-body collapse" id="exportieren_felder_waehlen_collapse">
							<div class="accordion-inner">
								<div class="well well-small" style="margin-bottom:15px;">So geht's:
									<ul>
										<li>Nachfolgend sind alle Eigenschaften aufgelistet, die in den gewählten Gruppen vorkommen</li>
										<li>Bestimmen Sie, ob Informationen von Synonymen mitgeliefert werden sollen...</li>
										<li>...markieren Sie die Eigenschaften, die Sie exportieren möchten...</li>
										<li>...und fahren Sie danach mit "4. Exportieren" weiter</li>
									</ul>
								</div>
								<label class="checkbox">
									<input type="checkbox" id="exportieren_synonym_infos" checked>
									inklusive Informationen von Synonymen
								</label>
								<hr>
								<h3>Art / Lebensraum</h3>
								<div class="felderspalte">
									<label class="checkbox">
										<input id="exportieren_felder_waehlen_objekt_id" class="exportieren_felder_waehlen_objekt_feld feld_waehlen" type="checkbox" feldname="GUID" value="_id">GUID
									</label>
									<label class="checkbox">
										<input id="exportieren_felder_waehlen_objekt_gruppe" class="exportieren_felder_waehlen_objekt_feld feld_waehlen" type="checkbox" feldname="Gruppe" value="Gruppe">Gruppe
									</label>
								</div>
								<div id="exportieren_felder_waehlen_felderliste"></div>
							</div>
						</div>
					</div>

					<div id="exportieren_exportieren" class="accordion-group">
						<div class="accordion-heading accordion-group_gradient">
							<a id="exportieren_exportieren_titel" class="accordion-toggle" data-toggle="collapse" data-target="#exportieren_exportieren_collapse" data-parent="exportieren_accordion" href="#exportieren_exportieren_collapse">4. Exportieren</a>
						</div>
						<div id="exportieren_exportieren_collapse" class="accordion-body collapse">
							<div class="accordion-inner">
								<div class="well well-small" style="margin-bottom:9px;">So geht's:
									<ul>
										<li>Klicken Sie auf "Vorschau anzeigen"...</li>
										<li>...danach wird eine Vorschau der ersten 10 Datensätze angezeigt</li>
										<li>...und es erscheint die Schaltfläche "herunterladen"</li>
										<li><strong>...das dauert eine ganze Weile. Geduld bringt Daten!</strong></li>
										<li>Der Download hat das .csv-Format:
											<ul>
												<li>Zeichensatz ist UTF-8 (wichtig, sonst werden Umlaute zu Datensalat)</li>
												<li>Die erste Zeile enthält die Feldnamen</li>
												<li>Felder sind mit Kommas (,) getrennt</li>
												<li>Text ist in Anführungs- und Schlusszeichen (") eingeschlossen</li>
											</ul>
										</li>
									</ul>
								</div>
								<button id="exportieren_exportieren_tabelle_aufbauen" class="btn">Vorschau anzeigen</button>
								<button id="exportieren_exportieren_exportieren" class="btn" style="display:none;">herunterladen</button>
								<div id="exportieren_exportieren_tabelle" class="tabelle" style="padding-top:7px;margin-bottom:7px;"></div>
								<div id="exportieren_exportieren_hinweis" class="alert alert-info" style="margin-top:7px;">
									<button type="button" class="close" data-dismiss="alert">&times;</button>
									<div id="exportieren_exportieren_hinweis_text"></div>
								</div>
							</div>
						</div>
					</div>

				</div>		
			</form>

		</fieldset>

		<script>
			$(document).ready(function () {
				$("#forms").hide();
				//prüfen, ob media queries unterstützt werden. Wenn nein, melden und Einsteigen verhindern
				if (!Modernizr.mq('(min-width: 10px)')) {
					$('#meldung_individuell_text').html("Ihr Browser unterstützt keine media queries<br>ArtenDb wird nicht optimal funktionieren");
					$('#meldung_individuell_label').html("inkompatibler Browser");
					$('#meldung_individuell').modal();
				}

				//prüfen, ob history unterstützt wird. Wenn nein, shim laden
				Modernizr.load({
					test: Modernizr.history,
					nope: 'vendor/couchapp/history.js'
				});

				BrowserDetect.init();
				//console.log('IE Version ' + BrowserDetect.version);
				if (BrowserDetect.browser == 'Explorer' && BrowserDetect.version < 9) {
					$('#meldung_kompatibilität').modal();
				}

				//falls URL übergeben wurde, das entsprechende Dokument öffnen
				//soll auch ausgelöst werden, wenn die Rücktaste oder Vortaste getätigt wird
				window.addEventListener('popstate', function(event) {
					console.log('oeffneUri');
					oeffneUri();
				});

				//wenn User noch angemeldet ist, UI anpassen
				if (localStorage.Email) {
					$(".importieren_anmelden_titel").text("1. " + localStorage.Email + " ist angemeldet");
					$(".anmelden_btn").hide();
					$(".abmelden_btn").show();
					$(".konto_erstellen_btn").hide();
					$(".konto_speichern_btn").hide();
				}

				//Baum aufbauen, wenn Gruppe gewählt wird
				$("#Gruppe").on("click", ".gruppe", function () {
					oeffneGruppe(this.value);
				});

				//Menu: Links zu Google Bilder und Wikipedia nur aktiv setzen, wenn Art oder Lebensraum angezeigt wird
				$("body").on("click", "#menu_btn", function() {
					if (localStorage.art_id) {
						$("#GoogleBilderLink_li").removeClass("disabled");
						$("#WikipediaLink_li").removeClass("disabled");
					} else {
						$("#GoogleBilderLink_li").addClass("disabled");
						$("#WikipediaLink_li").addClass("disabled");
					}
				});

				$("#menu_btn").on("click", "#ds_importieren", function() {
					//testen, ob der Browser das Importieren unterstützt
					//wenn nein, Meldung bringen (macht die aufgerufene Funktion)
					if(isFileAPIAvailable()) {
						zeigeFormular("importieren_ds");
						//Ist der User noch angemeldet? Wenn ja: Anmeldung überspringen
						if (localStorage.Email) {
							$("#importieren_ds_ds_beschreiben_collapse").collapse('show');
						} else {
							$("#importieren_ds_anmelden_collapse").collapse('show');
							$("#Email_ds").focus();
						}
					}
				});

				$("#menu_btn").on("click", "#bs_importieren", function() {
					//testen, ob der Browser das Importieren unterstützt
					//wenn nein, Meldung bringen (macht die aufgerufene Funktion)
					if(isFileAPIAvailable()) {
						zeigeFormular("importieren_bs");
						//Ist der User noch angemeldet? Wenn ja: Anmeldung überspringen
						if (localStorage.Email) {
							$("#importieren_bs_ds_beschreiben_collapse").collapse('show');
						} else {
							$("#importieren_bs_anmelden_collapse").collapse('show');
							$("#Email_bs").focus();
						}
					}
				});

				$('#importieren_ds_ds_beschreiben_collapse').on('shown', function() {
					//mitgeben, woher die Anfrage kommt, weil ev. angemeldet werden muss
					bereiteImportieren_ds_beschreibenVor("_ds");
					$("#DsImportiertVon").val(localStorage.Email);
				});

				$('#importieren_bs_ds_beschreiben_collapse').on('shown', function() {
					//mitgeben, woher die Anfrage kommt, weil ev. angemeldet werden muss
					bereiteImportieren_bs_beschreibenVor("_bs");
					$("#BsImportiertVon").val(localStorage.Email);
				});

				$('#importieren_ds_daten_uploaden_collapse').on('shown', function (event) {
					if (!localStorage.Email) {
						$(this).collapse('hide');
						zurueckZurAnmeldung("_ds");
					} else {
						$('#DsFile').fileupload();
					}
				});

				$('#importieren_bs_daten_uploaden_collapse').on('shown', function (event) {
					if (!localStorage.Email) {
						$(this).collapse('hide');
						zurueckZurAnmeldung("_bs");
					} else {
						$('#BsFile').fileupload();
					}
				});

				$('#importieren_ds_ids_identifizieren_collapse').on('shown', function (event) {
					if (!localStorage.Email) {
						$(this).collapse('hide');
						zurueckZurAnmeldung("_ds");
					}
				});

				$('#importieren_bs_ids_identifizieren_collapse').on('shown', function (event) {
					if (!localStorage.Email) {
						$(this).collapse('hide');
						zurueckZurAnmeldung("_bs");
					}
				});

				$('#importieren_ds_import_ausfuehren_collapse').on('shown', function (event) {
					if (!localStorage.Email) {
						$(this).collapse('hide');
						zurueckZurAnmeldung("_ds");
					}
				});

				$('#importieren_bs_import_ausfuehren_collapse').on('shown', function (event) {
					if (!localStorage.Email) {
						$(this).collapse('hide');
						zurueckZurAnmeldung("_bs");
					}
				});

				$("#importieren_ds").on("change", "#DsWaehlen", function() {
					var DsName = this.value;
					var waehlbar = $("#"+this.id+" option:selected").attr("waehlbar");
					if (waehlbar === "true") {
						//zuerst alle Felder leeren
						$('#importieren_ds_ds_beschreiben_collapse textarea, #importieren_ds_ds_beschreiben_collapse input').each(function () {
							$(this).val('');
						});
						$("#DsAnzDs").html("");
						$("#DsAnzDs_label").html("");
						if (DsName) {
							for (i in window.ds_von_objekten.rows) {
								if (window.ds_von_objekten.rows[i].key[1] === DsName) {
									$("#DsName").val(DsName);
									for (x in window.ds_von_objekten.rows[i].key[4]) {
										if (x === "Ursprungsdatensammlung") {
											$("#DsUrsprungsDs").val(window.ds_von_objekten.rows[i].key[4][x]);
										} else if (x !== "importiert von") {
											$("#Ds" + x).val(window.ds_von_objekten.rows[i].key[4][x]);
										}
									}
									if (window.ds_von_objekten.rows[i].key[2] === true) {
										$("#DsZusammenfassend").prop('checked', true);
										//Feld für Ursprungs-DS anzeigen
										$("#DsUrsprungsDs_div").show();
									} else {
										//sicherstellen, dass der Haken im Feld entfernt wird, wenn nach der zusammenfassenden eine andere DS gewählt wird
										$("#DsZusammenfassend").prop('checked', false);
										//und Feld für Ursprungs-DS verstecken
										$("#DsUrsprungsDs_div").hide();
									}
									//wenn die ds/bs kein "importiert von" hat ist der Wert null
									//verhindern, dass null angezeigt wird
									if (window.ds_von_objekten.rows[i].key[3]) {
										$("#DsImportiertVon").val(window.ds_von_objekten.rows[i].key[3]);
									} else {
										$("#DsImportiertVon").val("");
									}
									$("#DsAnzDs_label").html("Anzahl Arten/Lebensräume");
									$("#DsAnzDs").html(window.ds_von_objekten.rows[i].value);
									//dafür sorgen, dass textareas genug gross sind
									$('#importieren_ds textarea').each(function () {
										FitToContent(this, document.documentElement.clientHeight);
									});
									$("#DsName").focus();
								}
								//löschen-Schaltfläche einblenden
								$("#DsLoeschen").css("display", "block");
							}
						} else {
							//löschen-Schaltfläche ausblenden
							$("#DsLoeschen").css("display", "none");
						}
					} else {
						//melden, dass diese DS nicht bearbeitet werden kann
						$('#meldung_ds_nicht_bearbeitbar').modal();
					}
				});

				$("#importieren_ds").on("change", "#DsName", function() {
					var that = this;
					//suchen, ob schon eine Datensammlung mit diesem Namen existiert
					//und sie von jemand anderem importiert wurde
					//und sie nicht zusammenfassend ist
					var DsKey = _.find(window.DsKeys, function(key) {
						return key[1] === that.value && key[3] !== localStorage.Email && !key[2];
					});
					if (DsKey) {
						$("#importieren_ds_ds_beschreiben_hinweis2").alert().css("display", "block");
						$("#importieren_ds_ds_beschreiben_hinweis_text2").html('Es existiert schon eine gleich heissende und nicht zusammenfassende Datensammlung.<br>Sie wurde von jemand anderem importiert. Daher müssen Sie einen anderen Namen verwenden.');
						setTimeout(function() {
							$("#importieren_ds_ds_beschreiben_hinweis2").alert().css("display", "none");
						}, 30000);
						$("#DsName").val("");
						$("#DsName").focus();
					} else {
						$("#importieren_ds_ds_beschreiben_hinweis2").alert().css("display", "none");
					}
				});

				$("#importieren_bs").on("change", "#BsName", function() {
					var that = this;
					//suchen, ob schon eine Datensammlung mit diesem Namen existiert
					//und sie von jemand anderem importiert wurde
					//und sie nicht zusammenfassend ist
					var BsKey = _.find(window.BsKeys, function(key) {
						return key[1] === that.value && key[3] !== localStorage.Email && !key[2];
					});
					if (BsKey) {
						$("#importieren_bs_ds_beschreiben_hinweis2").alert().css("display", "block");
						$("#importieren_bs_ds_beschreiben_hinweis_text2").html('Es existiert schon eine gleich heissende und nicht zusammenfassende Beziehungssammlung.<br>Sie wurde von jemand anderem importiert. Daher müssen Sie einen anderen Namen verwenden.');
						setTimeout(function() {
							$("#importieren_bs_ds_beschreiben_hinweis2").alert().css("display", "none");
						}, 30000);
						$("#BsName").val("");
						$("#BsName").focus();
					} else {
						$("#importieren_bs_ds_beschreiben_hinweis2").alert().css("display", "none");
					}
				});

				$("#importieren_ds").on("change", "#DsImportiertVon", function() {
					$("#DsImportiertVon").val(localStorage.Email);
					$("#importieren_ds_ds_beschreiben_hinweis2").alert().css("display", "block");
					$("#importieren_ds_ds_beschreiben_hinweis_text2").html('"importiert von" ist immer die email-Adresse der angemeldeten Person');
					setTimeout(function() {
						$("#importieren_ds_ds_beschreiben_hinweis2").alert().css("display", "none");
					}, 10000);
				});

				$("#importieren_bs").on("change", "#BsImportiertVon", function() {
					$("#BsImportiertVon").val(localStorage.Email);
					$("#importieren_bs_ds_beschreiben_hinweis2").alert().css("display", "block");
					$("#importieren_bs_ds_beschreiben_hinweis_text2").html('"importiert von" ist immer die email-Adresse der angemeldeten Person');
					setTimeout(function() {
						$("#importieren_bs_ds_beschreiben_hinweis2").alert().css("display", "none");
					}, 10000);
				});

				$("#importieren_ds").on("change", "#DsZusammenfassend", function() {
					if ($(this).prop('checked')) {
						$(".DsUrsprungsDs").show();
					} else {
						$(".DsUrsprungsDs").hide();
					}
				});

				$("#importieren_bs").on("change", "#BsZusammenfassend", function() {
					if ($(this).prop('checked')) {
						$("#BsUrsprungsBs_div").show();
					} else {
						$("#BsUrsprungsBs_div").hide();
					}
				});

				$("#importieren_bs").on("change", "#BsWaehlen", function() {
					var BsName = this.value;
					var waehlbar = $("#"+this.id+" option:selected").attr("waehlbar");
					if (waehlbar === "true") {
						//zuerst alle Felder leeren
						$('#importieren_bs_ds_beschreiben_collapse textarea, #importieren_bs_ds_beschreiben_collapse input').each(function () {
							$(this).val('');
						});
						$("#BsAnzDs").html("");
						$("#BsAnzDs_label").html("");
						if (BsName) {
							for (i in window.bs_von_objekten.rows) {
								if (window.bs_von_objekten.rows[i].key[1] === BsName) {
									$("#BsName").val(BsName);
									for (x in window.bs_von_objekten.rows[i].key[4]) {
										if (x === "Ursprungsdatensammlung") {
											$("#BsUrsprungsBs").val(window.bs_von_objekten.rows[i].key[4][x]);
										} else if (x !== "importiert von") {
											$("#Bs" + x).val(window.bs_von_objekten.rows[i].key[4][x]);
										}
									}
									if (window.bs_von_objekten.rows[i].key[2] === true) {
										$("#BsZusammenfassend").prop('checked', true);
										$("#BsUrsprungsBs_div").show();
									} else {
										//sicherstellen, dass der Haken im Feld entfernt wird, wenn nach der zusammenfassenden eine andere BS gewählt wird
										$("#BsZusammenfassend").prop('checked', false);
										$("#BsUrsprungsBs_div").hide();
									}
									//wenn die ds/bs kein "importiert von" hat ist der Wert null
									//verhindern, dass null angezeigt wird
									if (window.bs_von_objekten.rows[i].key[3]) {
										$("#BsImportiertVon").val(window.bs_von_objekten.rows[i].key[3]);
									} else {
										$("#BsImportiertVon").val("");
									}
									$("#BsAnzDs_label").html("Anzahl Arten/Lebensräume");
									$("#BsAnzDs").html(window.bs_von_objekten.rows[i].value);
									//dafür sorgen, dass textareas genug gross sind
									$('#importieren_bs textarea').each(function () {
										FitToContent(this, document.documentElement.clientHeight);
									});
									$("#BsName").focus();
								}
								//löschen-Schaltfläche einblenden
								$("#BsLoeschen").css("display", "block");
							}
						} else {
							//löschen-Schaltfläche ausblenden
							$("#BsLoeschen").css("display", "none");
						}
					} else {
						//melden, dass diese BS nicht bearbeitet werden kann
						$('#meldung_bs_nicht_bearbeitbar').modal();
					}
				});

				$("#importieren_ds").on("change", "#DsFile", function(e) {
					e.preventDefault();
					// Check for the various File API support
					if (window.File && window.FileReader && window.FileList && window.Blob) {
						// Great success! All the File APIs are supported
					} else {
						alert('Ihr Browser unterstützt diesen Vorgang leider nicht');
						return;
					}
					var file = e.target.files[0],
					reader = new FileReader();
					if (typeof e.target.files[0] === "undefined") {
						//vorhandene Datei wurde entfernt
						$("#DsTabelleEigenschaften").css("display", "none");
						$("#importieren_ds_ids_identifizieren_fehler").css("display", "none");
						$("#importieren_ds_ids_identifizieren_erfolg").css("display", "none");
						$("#DsImportieren").css("display", "none");
						$("#DsEntfernen").css("display", "none");
					}
					reader.onload = function (event) {
						window.dsDatensätze = $.csv.toObjects(event.target.result);
						erstelleTabelle(window.dsDatensätze, "DsFelder_div", "DsTabelleEigenschaften");
					};
					reader.readAsText(file);
				});

				$("#importieren_bs").on("change", "#BsFile", function(e) {
					e.preventDefault();
					// Check for the various File API support
					if (window.File && window.FileReader && window.FileList && window.Blob) {
						// Great success! All the File APIs are supported
					} else {
						alert('Ihr Browser unterstützt diesen Vorgang leider nicht');
						return;
					}
					var file = e.target.files[0],
					reader = new FileReader();
					if (typeof e.target.files[0] === "undefined") {
						//vorhandene Datei wurde entfernt
						$("#BsTabelleEigenschaften").css("display", "none");
						$("#importieren_bs_ids_identifizieren_fehler").css("display", "none");
						$("#importieren_bs_ids_identifizieren_erfolg").css("display", "none");
						$("#BsImportieren").css("display", "none");
						$("#BsEntfernen").css("display", "none");
					}
					reader.onload = function (event) {
						window.bsDatensätze = $.csv.toObjects(event.target.result);
						erstelleTabelle(window.bsDatensätze, "BsFelder_div", "BsTabelleEigenschaften");
					};
					reader.readAsText(file);
				});

				$("#importieren_ds").on("change", "#DsFelder", function(e) {
					meldeErfolgVonIdIdentifikation("Ds");
				});

				$("#importieren_bs").on("change", "#BsFelder", function(e) {
					meldeErfolgVonIdIdentifikation("Bs");
				});

				$("#importieren_ds").on("change", "#DsId", function(e) {
					meldeErfolgVonIdIdentifikation("Ds");
				});

				$("#importieren_bs").on("change", "#BsId", function(e) {
					meldeErfolgVonIdIdentifikation("Bs");
				});

				$("#importieren_ds").on("click", "#DsLoeschen", function(e) {
					e.preventDefault();
					//Rückmeldung anzeigen
					$("#importieren_ds_ds_beschreiben_hinweis").alert().css("display", "block");
					$("#importieren_ds_ds_beschreiben_hinweis_text").html("Bitte warten: Die Datensammlung wird entfernt...");
					$.when(entferneDatensammlungAusAllenObjekten($("#DsName").val())).then(function() {
						//jetzt Ergebnisse anzeigen
						$("#importieren_ds_ds_beschreiben_hinweis").alert().css("display", "block");
						$("#importieren_ds_ds_beschreiben_hinweis_text").html("Die Datensammlung wurde erfolgreich entfernt");
					});
				});

				$("#importieren_bs").on("click", "#BsLoeschen", function(e) {
					e.preventDefault();
					//Rückmeldung anzeigen
					$("#importieren_bs_ds_beschreiben_hinweis").alert().css("display", "block");
					$("#importieren_bs_ds_beschreiben_hinweis_text").html("Bitte warten: Die Beziehungssammlung wird entfernt...");
					$.when(entferneBeziehungssammlungAusAllenObjekten($("#BsName").val())).then(function() {
						//jetzt Ergebnisse anzeigen
						$("#importieren_bs_ds_beschreiben_hinweis").alert().css("display", "block");
						$("#importieren_bs_ds_beschreiben_hinweis_text").html("Die Beziehungssammlung wurde erfolgreich entfernt");
					});
				});

				$("#importieren_ds").on("click", "#DsImportieren", function(e) {
					e.preventDefault();
					$.when(importiereDatensammlung()).then(function() {
						//jetzt Ergebnisse anzeigen
						console.log("Datensammlung importiert");
					});
				});

				$("#importieren_bs").on("click", "#BsImportieren", function(e) {
					e.preventDefault();
					$.when(importiereBeziehungssammlung()).then(function() {
						//jetzt Ergebnisse anzeigen
						console.log("Beziehungssammlung importiert");
					});
				});

				$("#importieren_ds").on("click", "#DsEntfernen", function(e) {
					e.preventDefault();
					$.when(entferneDatensammlung()).then(function() {
						//jetzt Ergebnisse anzeigen
						console.log("Datensammlung entfernt");
					});
				});

				$("#importieren_bs").on("click", "#BsEntfernen", function(e) {
					e.preventDefault();
					$.when(entferneBeziehungssammlung()).then(function() {
						//jetzt Ergebnisse anzeigen
						console.log("Beziehungssammlung entfernt");
					});
				});

				$("#menu_btn").on("click", "#exportieren", function() {
					zeigeFormular("export");
					//Exportieren-Guids schaffen, damit kein altes existiert
					window.exportieren_guids = [];
					delete window.exportieren_objekte;
					//Exportsicherung entfernen
					delete window.exportieren_objekte_sik;
				});

				$("#export").on("change", ".exportieren_ds_objekte_waehlen_gruppe", function() {
					erstelleListeFuerFeldwahl();
					//Tabelle ausblenden, falls sie eingeblendet war
					$("#exportieren_exportieren_tabelle").css("display", "none");
				});

				//kontrollieren, ob mehr als eine Beziehungssammlung angezeigt wird
				//und pro Beziehung eine Zeile ausgegeben wird. 
				//Wenn ja: reklamieren und rückgängig machen
				$("#export").on("change", ".feld_waehlen", function() {
					if ($("#export_bez_in_zeilen").prop('checked')) {
						var bezDsChecked = [];
						var that = this;
						$("#exportieren_felder_waehlen_felderliste .feld_waehlen").each(function() {
							if ($(this).prop('checked') && $(this).attr('dstyp') === "Beziehung") {
								bezDsChecked.push($(this).attr('datensammlung'));
							}
						});
						//eindeutige Liste der dsTypen erstellen
						bezDsChecked = _.union(bezDsChecked);
						if (bezDsChecked && bezDsChecked.length > 1) {
							$('#meldung_zuviele_bs').modal();
							$(that).prop('checked', false);
						} else {
							exportZuruecksetzen();
						}
					}
				});

				$("#export").on("change", ".feld_waehlen_alle_von_ds", function() {
					//wenn checked: alle unchecken, sonst alle checken
					var ds = $(this).attr('datensammlung');
					var status = false;
					if ($(this).prop('checked')) {
						status = true;
					}
					$('[datensammlung="'+ds+'"]').each(function() {
						$(this).prop('checked', status);
					});
				});

				$("#export").on("change", ".export_feld_filtern", function(event) {
					//kontrollieren, ob mehr als eine Beziehungssammlung Filter enthält. Wenn ja: reklamieren und rückgängig machen
					var bezDsFiltered = [];
					var that = this;
					$("#exportieren_objekte_waehlen_ds_collapse .export_feld_filtern").each(function() {
						if ((this.value || this.value === 0) && $(this).attr('dstyp') === "Beziehung") {
							bezDsFiltered.push($(this).attr('eigenschaft'));
						}
					});
					//eindeutige Liste der dsTypen erstellen
					bezDsFiltered = _.union(bezDsFiltered);
					if (bezDsFiltered && bezDsFiltered.length > 1) {
						$('#meldung_zuviele_bs').modal();
						$(this).val("");
					} else {
						exportZuruecksetzen();
					}
				});

				$("#export").on("change", "#export_bez_in_zeilen,#export_bez_in_feldern,#exportieren_synonym_infos,#exportieren_nur_ds,.feld_waehlen_alle_von_ds", function() {
					exportZuruecksetzen();
				});

				$("#exportieren_exportieren").on("show", function() {
					//zur Schaltfläche Vorschau scrollen
					$('html, body').animate({
						scrollTop: $("#exportieren_exportieren_tabelle_aufbauen").offset().top
					}, 2000);
				});

				$("#art").on("click", ".btn.lr_bearb", function(event) {
					event.preventDefault();
				});

				$("#art").on("click", ".btn.lr_bearb_bearb", function() {
					bearbeiteLrTaxonomie();
				});

				$("#art").on("click", ".btn.lr_bearb_schuetzen", function() {
					schuetzeLrTaxonomie();
					//Einstellung merken, damit auch nach Datensatzwechsel die Bearbeitbarkeit bleibt
					delete window.lr_bearb;
				});

				$("#art").on("click", ".btn.lr_bearb_neu", function() {
					initiiereLrParentAuswahlliste($("#Taxonomie").val());
				});

				$("#lr_parent_waehlen_optionen").on("change", '[name="parent_optionen"]', function() {
					//prüfen, ob oberster Node gewählt wurde
					var parent_name = $(this).val(),
					parent_id = this.id,
						parent_row, 
						parent = {}, 
						object = {};
					//zuerst eine id holen
					object._id = $.couch.newUUID(1);
					object.Gruppe = "Lebensräume";
					object.Typ = "Objekt";
					object.Taxonomie = {};
					object.Taxonomie.Name = "neue Taxonomie";	//wenn nicht Wurzel, setzen. Passiert in aktualisiereHierarchieEinesNeuenLr
					object.Taxonomie.Daten = {};
					object.Taxonomie.Daten.Taxonomie = "neue Taxonomie";	//wenn nicht Wurzel, setzen. Passiert in aktualisiereHierarchieEinesNeuenLr
					//wenn keine Wurzel: Label anzeigen
					if (parent_id !== "0") {
						object.Taxonomie.Daten.Label = "";
					}
					object.Taxonomie.Daten.Einheit = "unbeschriebener Lebensraum";
					if (parent_id === "0") {
						object.Taxonomie.Daten.Einheit = "neue Taxonomie";
					}
					/*Einheit-Nr FNS wird nicht mehr benötigt, bzw. unabhängig führen
					object.Taxonomie.Daten["Einheit-Nr FNS"] = "";
					if (parent_id === "0") {
						object.Taxonomie.Daten["Einheit-Nrn FNS von"] = "";
						object.Taxonomie.Daten["Einheit-Nrn FNS bis"] = "";
					}*/
					object.Taxonomie.Daten["Beschreibung"] = "";
					object.Datensammlungen = [];
					object.Beziehungssammlungen = [];
					//jetzt den parent erstellen
					//geht nicht vorher, weil die id bekannt sein muss
					if (parent_id === "0") {
						//das ist die Wurzel der Taxonomie
						parent.Name = "neue Taxonomie";
						parent.GUID = object._id;
						//bei der Wurzel ist Hierarchie gleich parent
						object.Taxonomie.Daten.Hierarchie = [];
						object.Taxonomie.Daten.Hierarchie.push(parent);
					} else {
						parent.Name = parent_name;
						parent.GUID = parent_id;
					}
					object.Taxonomie.Daten.Parent = parent;
					$db = $.couch.db("artendb");
					$db.saveDoc(object, {
						success: function (data2) {
							object._rev = data2.rev;
							if (parent_id !== "0") {
								//die Hierarchie aufbauen und setzen
								//bei der Wurzel ist sie schon gesetzt
								aktualisiereHierarchieEinesNeuenLr(null, object, true);
							} else {
								$.when(erstelleBaum()).then(function() {
									oeffneBaumZuId(object._id);
									$('#lr_parent_waehlen').modal('hide');
								});
							}
						}
					});
				});

				$("#art").on("click", ".btn.lr_bearb_loeschen", function() {
					if (!$(this).hasClass('disabled')) {
						//rückfragen
						$('#rueckfrage_lr_loeschen').modal();
					}
				});

				$(document).on("click", "#rueckfrage_lr_loeschen_ja", function(event) {
					event.preventDefault();
					//zuerst die id des Objekts holen
					var uri = new Uri($(location).attr('href'));
					var id = uri.getQueryParamValue('id');
					//Objekt selbst inkl. aller hierarchisch darunter liegende Objekte ermitteln und löschen
					$db = $.couch.db("artendb");
					$db.view('artendb/hierarchie?key="' + id + '"&include_docs=true', {
						success: function (data) {
							//daraus einen Array von docs machen
							var doc_array = _.map(data.rows, function(row) {
								return row.doc;
							});
							//und diese Dokumente nun löschen
							loescheMassenMitObjektArray(doc_array);
							//vorigen node ermitteln
							var voriger_node = $.jstree._reference("#" + id)._get_prev("#" + id);
							//node des gelöschten LR entfernen
							jQuery.jstree._reference("#" + id).delete_node("#" + id);
							//vorigen node öffnen
							if (voriger_node) {
								$.jstree._reference(voriger_node).select_node(voriger_node);
							} else {
								oeffneGruppe("Lebensräume");
							}
						}
					});
				});

				$("#art").on("change", ".accordion-body.Lebensräume.Taxonomie .controls", function() {
					speichern($(this).val(), this.id, $(this).attr('dsName'), $(this).attr('dsTyp'))
				});

				$('#art').on('shown', '.accordion-body.Lebensräume.Taxonomie', function () {
					if (window.lr_bearb) {
						bearbeiteLrTaxonomie();
					}
					$(".bearb_toolbar").show();
				});

				$('#art').on('hidden', '.accordion-body.Lebensräume.Taxonomie', function () {
					$(".bearb_toolbar").hide();
				});

				$("#export").on("click", "#exportieren_objekte_Taxonomien_zusammenfassen", function(event) {
					//verhindern, dass bootstrap ganz nach oben scrollt
					event.preventDefault();
					var hinweisNeu;
					if ($(this).hasClass("active")) {
						window.fasseTaxonomienZusammen = false;
						$(this).html("Alle Taxonomien zusammenfassen");
						hinweisNeu = "<br>Alle Taxonomien sind zusammengefasst";
					} else {
						window.fasseTaxonomienZusammen = true;
						$(this).html("Taxonomien einzeln behandeln");
						hinweisNeu = "<br>Alle Taxonomien werden einzeln dargestellt";
					}
					//Felder neu aufbauen, aber nur, wenn eine Gruppe gewählt ist
					var gruppeIstGewählt = false;
					$("#exportieren_objekte_waehlen_gruppen_collapse .exportieren_ds_objekte_waehlen_gruppe").each(function() {
						if ($(this).prop('checked')) {
							gruppeIstGewählt = true;
						}
					});
					if (gruppeIstGewählt) {
						erstelleListeFuerFeldwahl();
					}
				});

				$("#export").on("click", "#exportieren_exportieren_tabelle_aufbauen", function(event) {
					//verhindern, dass bootstrap ganz nach oben scrollt
					event.preventDefault();
					//Tabelle und Herunterladen-Schaltfläche ausblenden
					$("#exportieren_exportieren_tabelle").css("display", "none");
					$("#exportieren_exportieren_exportieren").css("display", "none");
					//filtert und baut danach die Vorschautabelle auf
					filtereFuerExport();
				});

				$("#export").on("click", "#exportieren_exportieren_exportieren", function(event) {
					//verhindern, dass bootstrap ganz nach oben scrollt
					event.preventDefault();	
					//das funktioniert nicht so super:
					//Chrome: super
					//Firefox: Dateiname verändert. Leeres Fenster geöffnet
					//Safari auf MacOs: Fehlermeldung
					//iOs: Fehlermeldung
					//Android Chrome: Download scheint nicht zu Ende zu kommen, Datei unbenannt
					//soll besser werden, sobald Standards umgesetzt werden
					var blob = new Blob([window.exportstring], {type: "text/csv;charset=utf-8;"});
					//var blob = new Blob([window.exportstring], {type: "application/octet-stream;charset=utf-8;"});
					var d = new Date();
					var month = d.getMonth()+1;
					var day = d.getDate();
					var output = d.getFullYear() + '-' + (month<10 ? '0' : '') + month + '-' + (day<10 ? '0' : '') + day;
					saveAs(blob, output + "_export.csv");
				});

				$("#export").on("click", ".accordion-heading a", function(event) {
					//verhindern, dass bootstrap ganz nach oben scrollt
					event.preventDefault();
				});

				$("#importieren_ds").on("click", ".accordion-heading a", function(event) {
					//verhindern, dass bootstrap ganz nach oben scrollt
					event.preventDefault();
				});

				$(".form").on("keyup focus", "textarea", function() {
					FitToContent(this, document.documentElement.clientHeight);
				});

				//Klick auf Link zu Art steuern
				$(".form").on("click", ".LinkZuArtGleicherGruppe", function(event) {
					var id;
					event.preventDefault();
					id = $(this).attr("artid");
					$("#tree" + window.Gruppe).jstree("clear_search");
					$(".suchen").val("");
					jQuery("#tree" + window.Gruppe).jstree("deselect_all");
					jQuery("#tree" + window.Gruppe).jstree("close_all", -1);
					jQuery("#tree" + window.Gruppe).jstree("select_node", "#" + id);
				});
			});

			$(window).resize(function () {
				setzeTreehoehe();
				setzteHöheTextareas();
			});

			$(document).on("click", ".anmelden_btn", function(event) {
				event.preventDefault();
				//es muss mitgegeben werden, woher die Anmeldung kam, damit die email aus dem richtigen Feld geholt werden kann
				var bs_ds = this.id.substring(this.id.length-2);
				if (bs_ds === "rt") {
					bs_ds = "art";
				}
				meldeUserAn(bs_ds);
			});

			$(document).on("click", ".abmelden_btn", function(event) {
				event.preventDefault();
				meldeUserAb();
			});

			$(document).on("keyup", ".Email", function(event) {
				/*allfällig noch vorhandenen Hinweis ausblenden*/
				$(".Emailhinweis").css("display", "none");
			});

			$(document).on("keyup", ".Passwort", function(event) {
				/*allfällig noch vorhandenen Hinweis ausblenden*/
				$(".Passworthinweis").css("display", "none");
			});

			$(document).on("keyup", ".Passwort2", function(event) {
				/*allfällig noch vorhandenen Hinweis ausblenden*/
				$(".Passworthinweis2").css("display", "none");
			});

			$(document).on("click", ".konto_erstellen_btn", function(event) {
				event.preventDefault();
				var bs_ds = this.id.substring(this.id.length-2);
				if (bs_ds === "rt") {
					bs_ds = "art";
				}
				$(".signup").css("display", "block");
				$(".anmelden_btn").hide();
				$(".abmelden_btn").hide();
				$(".konto_erstellen_btn").hide();
				$(".konto_speichern_btn").show();
				$(".importieren_anmelden_fehler").hide();
				setTimeout(function() {
					$("#Email_" + bs_ds).focus();
				}, 50);  //need to use a timer so that .blur() can finish before you do .focus()
			});

			$(document).on("click", ".konto_speichern_btn", function(event) {
				event.preventDefault();
				var bs_ds = this.id.substring(this.id.length-2);
				if (bs_ds === "rt") {
					bs_ds = "art";
				}
				if (validiereSignup(bs_ds)) {
					erstelleKonto(bs_ds);
					//Anmeldefenster zurücksetzen
					$(".signup").css("display", "none");
					$(".anmelden_btn").hide();
					$(".abmelden_btn").show();
					$(".konto_erstellen_btn").hide();
					$(".konto_speichern_btn").hide();
				}
			});

		</script>
	</body>
	<div id="Meldung"></div>
	
	<div id="meldung_kompatibilität" class="modal hide fade">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			<h3>inkompatibler Browser</h3>
		</div>
		<div class="modal-body">
			<p>Ihr Browser unterstützt nicht alle Funktionen, die ArtenDb voraussetzt.<br><br>Um mit ArtenDb zu arbeiten, verwenden Sie eine aktuelle Version von z.B. <a href='http://www.google.de/chrome/'>Google Chrome</a> oder <a href='http://www.mozilla.org/de/firefox/new/'>Mozilla Firefox</a>.</p>
		</div>
	</div>

	<!-- Modal -->
	<div id="fileApiMeldung" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">inkompatibler Browser</h3>
		</div>
		<div class="modal-body">
			<p id="fileApiMeldungText">One fine body…</p>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">schliessen</button>
		</div>
	</div>

	<div id="meldung_zuviele_bs" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">Zuviele Beziehungssammlungen gewählt</h3>
		</div>
		<div class="modal-body">
			<p id="fileApiMeldungText">Es können nur Daten aus einer Beziehungssammlung gleichzeitig exportiert werden.<br>Grund: Für jede Beziehung wird eine neue Zeile erstellt</p>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">schliessen</button>
		</div>
	</div>

	<div id="meldung_keine_exportdaten" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">Keine Daten gewählt</h3>
		</div>
		<div class="modal-body">
			<p id="fileApiMeldungText">Es gibt keine Daten, die exportiert werden könnten.<br>Bitte prüfen Sie die Filterkriterien</p>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">schliessen</button>
		</div>
	</div>

	<div id="meldung_ds_nicht_bearbeitbar" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3>leider nein...</h3>
		</div>
		<div class="modal-body">
			<p>Sie können nur Datensammlungen verändern, die Sie selber importiert haben<br>Ausnahme: Zusammenfassende Datensammlungen</p>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">schliessen</button>
		</div>
	</div>

	<div id="meldung_bs_nicht_bearbeitbar" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3>leider nein...</h3>
		</div>
		<div class="modal-body">
			<p>Sie können nur Beziehungssammlungen verändern, die Sie selber importiert haben<br>Ausnahme: Zusammenfassende Beziehungssammlungen</p>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">schliessen</button>
		</div>
	</div>

	<div id="meldung_keine_ds" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">Keine Eigenschaften gewählt</h3>
		</div>
		<div class="modal-body">
			<p id="fileApiMeldungText">Bitte wählen Sie Eigenschaften, die exportiert werden sollen</p>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">schliessen</button>
		</div>
	</div>

	<div id="meldung_keine_gruppen" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">Keine Gruppe gewählt</h3>
		</div>
		<div class="modal-body">
			<p id="fileApiMeldungText">Bitte wählen Sie mindestens eine Gruppe, deren Daten exportiert werden sollen</p>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">schliessen</button>
		</div>
	</div>

	<div id="meldung_individuell" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="meldung_individuell_label">Beispielstext</h3>
		</div>
		<div class="modal-body">
			<p id="meldung_individuell_text">Beispielstext</p>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">schliessen</button>
		</div>
	</div>

	<div id="rueckfrage_lr_loeschen" class="modal hide fade">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			<h3 id="rueckfrage_lr_loeschen_label">Sicher?</h3>
		</div>
		<div class="modal-body">
			<p id="rueckfrage_lr_loeschen_text">Wollen Sie diesen Lebensraum wirklich löschen?<br>Alle hierarchisch darunter liegenden werden mit gelöscht!</p>
		</div>
		<div class="modal-footer">
			<a href="#" class="btn" data-dismiss="modal" id="rueckfrage_lr_loeschen_abbrechen">nein, abbrechen</a>
			<a href="#" class="btn btn-primary" id="rueckfrage_lr_loeschen_ja" data-dismiss="modal">ja, löschen</a>
		</div>
	</div>

	<div id="lr_parent_waehlen" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			<h3>Hierarchie</h3>
		</div>
		<div id="lr_parent_waehlen_optionen" class="modal-body" style="margin-bottom:5px;">
		</div>
	</div>
</html>